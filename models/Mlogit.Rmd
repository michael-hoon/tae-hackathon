---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
rm(list=ls())
library(mlogit)
safety <- read.csv("C:/Users/Razer/Downloads/Telegram Desktop/train1.csv")
which(colnames(safety)=="CC1")
which(colnames(safety)=="Price4")

S <- dfidx(safety, shape="wide", choice="Choice", sep="", varying = c(4:83), idx = c("No", "Case"))
head(S)
table(safety$Choice)
summary(S)

```

```{r}
M<-mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price|incomeind+ppark+gender+educind+Urb+agea+segmentind+year+milesa+regionind+nighta, data=S)
M$logLik
summary(M)
```

```{r}

ActualChoice <- safety[,"Choice"]
P <- predict(M, newdata=S)
PredictedChoice <- apply(P,1,which.max)
```

```{r}
Tabtrain=table(PredictedChoice, ActualChoice)
Tabtrain
```
```{r}
CorPredTrain<-sum(diag(Tabtrain))/sum(Tabtrain)
CorPredTrain
```

**Predicted Output
```{r}
test <- read.csv("C:/Users/Razer/Downloads/Telegram Desktop/test1.csv")

MrChoice <-sample(c(1,2,3,4),nrow(test),replace=TRUE, prob = c(0.25, 0.25, 0.25,0.25))
test$Choice<-MrChoice
table(test$Choice)
S1 <- dfidx(test, shape="wide", choice="Choice", sep="", varying = c(4:83), idx = c("No", "Case"))
head(S1)
P1 <- predict(M, newdata=S1)
PredictedTest <- apply(P1,1,which.max)
table(PredictedTest)

```

```{r}
LL0 <- 8949*log(1/4)
LLbeta = as.numeric(M$logLik)
LLR = 1-LLbeta/LL0
LLR
p = 20
AIC = -2*LLbeta + 2*p
AIC
LogLoss = -1*log(LLbeta,base=exp(1))
LogLoss
```



```{r}
write.csv(P1,file="C:/Users/Razer/Downloads/submission_3.csv")
#write.csv(PredictedTest,file="submission_1a.csv")
```



```{r}
library(leaps)
model1 <- regsubsets(Choice~.,data=S,nvmax=38)
```
```{r}
model2 <- regsubsets(Choice~.,data=s,nvmax=19,method="forward")
plot(summary(model2)$rsq)
plot(summary(model2)$adjr2)
which.max(summary(model2)$adjr2)
coef(model2,29)
plot(model2,scale=c("r2")) 
```



LASSO
```{r}
library(ggplot2)
library(glmnet) # package for doing LASSO
x <- as.matrix(safety[,c(4:83)]) 
model3 <- glmnet(x,safety$Choice)
model3
model3$lambda # generates all lambda
summary(model3) # beta0 is stored in a0
plot(model3,xvar="lambda")
# 
```

