---
title: "XGradientBoosting"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}
remove(list=ls())
#install.packages('xgboost')
library(xgboost)
library(caTools)
library(dplyr)
library(caret)

setwd("C:/Users/Razer/Downloads/Telegram Desktop")
#safety<-read.csv("train1.csv")
safety<-read.csv("C:/Users/Razer/Downloads/Telegram Desktop/train1.csv")
danger<-read.csv("C:/Users/Razer/Downloads/Telegram Desktop/test1.csv")
MrChoice <-sample(c(1,2,3,4),nrow(danger),replace=TRUE, prob = c(0.25, 0.25, 0.25,0.25))
danger$Choice<-MrChoice

safety3<-subset(safety,select=-c(Task,Ch1,Ch2,Ch3,Ch4,educ, gender,region,segment,ppark,night,miles,Case,No,CC4,GN4,NS4,BU4,FA4,LD4,BZ4,FC4,FP4,RP4,PP4,KA4,SC4,TS4,NV4,MA4,LB4,AF4,HU4,Price4,Urb,income,age))
test<-subset(danger,select=-c(Task,Ch1,Ch2,Ch3,Ch4,educ, gender,region,segment,ppark,night,miles,Case,No,CC4,GN4,NS4,BU4,FA4,LD4,BZ4,FC4,FP4,RP4,PP4,KA4,SC4,TS4,NV4,MA4,LB4,AF4,HU4,Price4,Urb,income,age))


```

```{r}
set.seed(0)
spl1 <- sample(1:nrow(safety3), 2157)
train1    <- safety3[spl1,]
set.seed(12)
spl2 <- sample(1:nrow(safety3), 2157)
train2    <- safety3[spl2,]
set.seed(120)
spl3 <- sample(1:nrow(safety3), 2157)
train3    <- safety3[spl3,]
set.seed(53)
spl4 <- sample(1:nrow(safety3), 2157)
train4    <- safety3[spl4,]

y_train <- as.numeric(safety3$Choice) -1
y_test <- as.integer(safety3$Choice)-1
X_train <- safety3 %>% select(-Choice)
X_test <- safety3 %>% select(-Choice)
```

```{r}
xgb_train <- xgb.DMatrix(data = as.matrix(X_train), label = y_train)
xgb_test <- xgb.DMatrix(data = as.matrix(X_test), label = y_test)
xgb_params <- list(
  booster = "gbtree",
  eta = 0.01,
  max_depth = 8,
  gamma = 4,
  subsample = 0.75,
  colsample_bytree = 1,
  objective = "multi:softprob",
  eval_metric = "mlogloss",
  num_class = 4
)
```

```{r}
xgb_model <- xgb.train(
  params = xgb_params,
  data = xgb_train,
  nrounds = 5000,
  verbose = 1
)
xgb_model
```

```{r}
xgb_preds <- predict(xgb_model, as.matrix(X_test), reshape = TRUE)
xgb_preds <- as.data.frame(xgb_preds)
colnames(xgb_preds) <- c("1","2","3","4")
xgb_preds
# write.csv(xgb_preds,"C:/Users/Razer/Downloads/submission_11.csv")
```

```{r}
xgb_preds$PredictedClass <- apply(xgb_preds, 1, function(y) colnames(xgb_preds)[which.max(y)])
xgb_preds$ActualClass <- safety3[,"Choice"]

xgb_preds
```

```{r}
accuracy <- sum(xgb_preds$PredictedClass == xgb_preds$ActualClass) / nrow(xgb_preds)
accuracy
```

```{r}
confusionMatrix(factor(xgb_preds$ActualClass), factor(xgb_preds$PredictedClass))

```
